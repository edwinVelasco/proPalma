<div class="register-box">

      <div class="register-box-body">
        <p class="login-box-msg">Editar Correcci贸n de Suelos</p>

        <form action="editar_correccion" id="editar_correccion" method="post">
            <div id="tok">

            </div>
            <fieldset>

                <div class="row form-group">
                    <div class="col-xs-6">
                        <select id="unidad" name="unidad" class="form-control" >

                        </select>
                    </div>
                    <div class="col-xs-6">
                        <input class="form-control" id="area" name="area" placeholder="Area" type="number" required title="Area de Aplicacion de la Enmienda" disabled />
                    </div>
                </div>

                <div class="row form-group">
                    <div class="col-xs-6">
                        <select id="enmienda" name="enmienda" class="form-control" title="Enmienda Aplicada">

                        </select>
                    </div>
                    <div class="col-xs-6">
                        <input class="form-control" id="cantidad" name="cantidad" placeholder="Cantidad" type="number" required title="Cantidad" value="1" onkeyup="campos_completar()"/>
                    </div>
                </div>

                <div class="row form-group">
                    <div class="col-xs-6">
                        <input class="form-control" id="precio_en" name="precio_en" placeholder="Precio Enmienda" type="number" required title="Precio de le Enmienda"  onkeyup="campos_completar()" value="1"/>
                    </div>
                    <div class="col-xs-6">
                        <input class="form-control" id="subtotal" name="subtotal" placeholder="SubTotal" type="number" required title="SubTotal" disabled/>
                    </div>
                </div>

                <div class="row form-group">
                    <div class="col-xs-6">
                        <input class="form-control" id="precio_apli" name="precio_apli" placeholder="Precio Aplicaci贸n" type="number" required title="Precio de Aplicacion de la Enmienda" value="1" />
                    </div>
                    <div class="col-xs-6">
                        <input class="form-control" id="fecha" name="fecha" placeholder="Fecha" type="text" required title="Fecha de Aplicaci贸n de la Enmienda"/>
                    </div>
                </div>



          <div class="row">
            <div class="col-xs-8">

            </div>
            <div class="col-xs-4">
              <button type="submit" class="btn btn-primary">Guardar</button>
            </div>
          </div>

                </fieldset>
        </form>

      </div>
    </div>
<script>
    var a_editar;

    jQuery(document).ready(function(){
        etiqueta_id = '<input name="id" value="'+hacienda_editar+'" type="hidden">'
        $('#tok').html(token+etiqueta_id);
        frm = $('#editar_correccion');
        $("#fecha").datepicker();
        get_correccion_editar();

      });

    function get_unidades_correccion(){
        $.ajax({
            type: "GET",
            url: "get_unidades",
            data: {'tipo':'p'},
            success: function (data) {
                if (data.length == 0)
                {
                    UIkit.notify({
                        message : 'No hay Unidades Registradas',
                        status  : 'warning',
                        timeout : 4000,
                        pos:'top-center'
                    });
                }
                else{
                    option = '<option value="0">Unidades</option>';
                    $('#unidad').append(option);
                    for (i=0; i< data.length; i++)
                    {
                        option = '<option value="'+data[i].pk+'">'+data[i].fields.unidad+'</option>';
                        $('#unidad').append(option);
                    }
                }

                $('#unidad').val(a_editar[4]);

            },
            error: function(data) {
                console.log(data)
            }
        });
        return false;
    }

    function get_enmiendas_correccion(){
        $.ajax({
            type: "GET",
            url: "get_enmiendas",
            data: "",
            success: function (data) {
                if (data.length == 0)
                {
                    UIkit.notify({
                        message : 'No hay Enmiendas Registradas',
                        status  : 'warning',
                        timeout : 4000,
                        pos:'top-center'
                    });
                }
                else{
                    option = '<option value="0">Enmienda</option>';
                    $('#enmienda').append(option);
                    for (i=0; i< data.length; i++)
                    {
                        option = '<option value="'+data[i].pk+'">'+data[i].fields.enmienda+'</option>';
                        $('#enmienda').append(option);
                    }
                }
                $('#enmienda').val(a_editar[0]);;
            },
            error: function(data) {
                console.log(data)
            }
        });
        return false;
    }

    function get_correccion_editar(){
        $.ajax({
            type: "GET",
            url: "get_correccion",
            data: {'id':hacienda_editar},
            success: function (data) {
                asignar_editar(data);

            },
            error: function(data) {
                console.log(data)
            }
        });
        return false;
    }

    function asignar_editar(data){
        a_editar = data.split(',');
        console.log(a_editar);
        /**
         * a_editar[0] = enmienda
         * a_editar[1] = cantidad
         * a_editar[2] = precio enmienda
         * a_editar[3] = precio aplicacion
         * a_editar[4] = unidad
         * a_editar[5] = area
         * a_editar[6] = fecha de aplicacion
         * a_editar[7] = subtotal
         */
        $("#cantidad").val(a_editar[1]);
        $("#precio_en").val(a_editar[2]);
        $("#precio_apli").val(a_editar[3]);
        $("#area").val(a_editar[5]);
        $("#fecha").val(a_editar[6]);
        $("#subtotal").val(a_editar[7]);

        get_enmiendas_correccion();
        get_unidades_correccion();
    }

    function campos_completar(){
        a = $('#area').val();
        c = $('#cantidad').val();
        p = $('#precio_en').val();
        if (a == '' || c == '' || p == ''){

        }
        else{
            area = a*1;
            cantidad = c*1;
            precio_en = p*1;
            subt = area*cantidad*precio_en;
            $('#subtotal').val(subt);
            aplicacion = subt*0.1;
            $('#precio_apli').val(aplicacion.toFixed(2));

        }
    }

    frm.submit(function () {
        $('#subtotal').removeAttr('disabled');
        $('#area').removeAttr('disabled');

        $.ajax({
            type: frm.attr('method'),
            url: frm.attr('action'),
            data: frm.serialize(),
            success: function (data) {
                $('#subtotal').attr('disabled','disabled');
                $('#area').attr('disabled','disabled');
                if (data === 'error')
                    {
                        UIkit.notify({
                            message : 'Upps! algo salio mal, revisa los datos XD',
                            status  : 'danger',
                            timeout : 3000,
                            pos:'top-center'
                        });
                    }
                else if (data === 'area')
                    {
                        UIkit.notify({
                            message : 'El Area es Mayor que el Area de la Zona/Lote',
                            status  : 'warning',
                            timeout : 3000,
                            pos:'top-center'
                        });
                    }
                else
                    {
                        UIkit.notify({
                            message : 'Correcci贸n Editada Con Exito',
                            status  : 'success',
                            timeout : 3000,
                            pos:'top-center'
                        });
                        get_correcciones_suelo();
                    }
            },
            error: function(data) {
                alert(data);
                console.log(data)
            }
        });
        return false;
    });
</script>